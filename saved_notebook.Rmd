---
title: "Mediterranean Refugee Deaths"
author: "Rachit Kinger"
date: "8 Jun 2018"
output: html_notebook
---

```{r load_data, echo = FALSE, message = FALSE, warning = FALSE}
library(knitr)
library(animation)
ani.options(autobrowse = FALSE, ani.width = 850, ani.height = 510)
opts_knit$set(animation.fun = function(x, options, format = "gif") {
x = c(knitr:::sans_ext(x), knitr:::file_ext(x))
fig.num = options$fig.num
format = sub("^[.]", "", format)
base = sub(paste0(fig.num, '$'), '', x[1])
fig.fname = paste0(sub(paste0(fig.num, "$"), "*", x[1]),
".", x[2])
mov.fname = paste0(sub('-$', '', base), '.', format)
# order correctly
figs <- Sys.glob(fig.fname)
figs <- figs[order(as.numeric(stringr::str_match(figs, paste0("(\\d+)\\.", x[2]))[, 2]))]
animation::im.convert(figs, output = mov.fname)
original_path <- basename(mov.fname)
file.rename(original_path, mov.fname)
file.remove(figs)
sprintf("![%s](%s)", options$label, paste0(opts_knit$get("base.url"), mov.fname))
})
knitr::opts_chunk$set(dpi = 150, fig.align = 'center', screenshot.force = FALSE, fig.height = 4, fig.cap = "", message = FALSE, warning =FALSE)
# options(width = 80, dplyr.width = 150)
```


## Exploring the data  

```{r build_environment}
loadPackages <- function() {
  library(dplyr)
  library(ggplot2)
  library(knitr)
  library(DT)
  library(lubridate)
  library(gganimate)
}

suppressPackageStartupMessages(loadPackages())

```
**NOTE**: Although the original source of this data is [Missing Migrants Project](https://missingmigrants.iom.int/) I received this file from Jonathan Miller via the wikitribune-community on slack.  

Before making any final conclusions from this analysis please take a look at the [methodology](https://missingmigrants.iom.int/methodology) on how this data was collected. Here are a few important points to note regarding methodology:  

* Only those migrants who died in a country different from their residence have been recorded  
* If a corpse was found, some inferences were made based on features of the corpse, where the corpse was found, etc.  
* The count excludes deaths that occur in immigration detention facilities, during deportation, or after forced return to a migrant’s homeland, as well as deaths more loosely connected with migrants´ irregular status, such as those resulting from labour exploitation. Deaths in refugee camps are included  
* Data collection: "...data are relayed from relevant national authorities to IOM field missions, who then share it with the Missing Migrants Project team. Data are also obtained by IOM and other organizations that receive survivors at landing points in Italy and Greece. IOM and UNHCR also regularly coordinate to validate data on missing migrants in the Mediterranean."  

Also note that the original data has one other piece of information called, _Source quality_, that is currently not found on the file used for this analysis. Source quality is a number assigned to each incident and ranges from 1 to 5, with 5 having the highest quality.  


```{r upload_data, warning=FALSE, message=FALSE}
raw <- readr::read_csv("Mediterranean refugee deaths.csv")
```

```{r}
# convert date into correct data type  
raw$`Reported Date` <- lubridate::mdy(raw$`Reported Date`)
```

**Time period of analysis**  
```{r}
range(raw$`Reported Date`)
```

Looking at total incidents, and then breakdown by route, gender, adult/children, etc.  

Total incidents in data set = `r nrow(raw)` 

```{r message=FALSE, warning=FALSE}
raw %>% 
  select(`Number Dead`, `Number Missing`, `Number of Survivors`,
         `Number of Females`, `Number of Males`, `Number of Children`) %>% 
  summarise_all(funs(sum(., na.rm = TRUE))) %>% 
  kable()
  
```

```{r}
raw %>% 
  select(`Number Dead`, `Number Missing`, `Number of Survivors`,
         `Number of Females`, `Number of Males`, `Number of Children`) %>% 
  summarise_all(funs(sum(., na.rm = TRUE))) %>% 
  tidyr::gather(key = Name, value = Number) %>% 
  ggplot() + 
  geom_col(mapping = aes(x = reorder(Name, -Number), y = Number, fill = Name), position = "dodge") + 
  geom_text(mapping = aes(x = Name, y = Number, label = scales::comma(Number)), nudge_y = 2000 ) +
  coord_flip() +
  theme(legend.position= "", legend.title=element_blank()) +
  xlab("") + ylab("") +
  ggtitle("Migrants: Dead, Survived or Missing",
          subtitle = "Jan-2014 to May-2018")
```

There is little data on gender and age of migrants mising or dead. Where reported the number of females/males/children reports the numbers on missing or dead migrants.  

```{r message=FALSE, warning=FALSE}
raw %>% 
  group_by(`Reported Year`) %>% 
  select(`Reported Year`, `Number Dead`, `Number Missing`, `Number of Survivors`,
         `Number of Females`, `Number of Males`, `Number of Children`) %>% 
  summarise_all(funs(sum(., na.rm = TRUE))) 
```

```{r message=FALSE, warning=FALSE}
raw %>% 
  group_by(`Reported Year`) %>% 
  select(`Reported Year`, `Number Dead`, `Number Missing`, `Number of Survivors`,
         `Number of Females`, `Number of Males`, `Number of Children`) %>% 
  summarise_all(funs(sum(., na.rm = TRUE)))  %>% 
  ggplot(aes(x = `Reported Year`)) +
  geom_col(aes(y = `Number Dead` + `Number Missing`, fill = "Total Dead and Missing"), alpha = 0.5) + 
  geom_line(aes(y = `Number Dead`, colour = "Number Dead")) +
  geom_line(aes(y = `Number Missing`, colour = "Number Missing")) +
  theme(legend.position="bottom", legend.title=element_blank()) +
  ggtitle("Migrant Deaths Over The Years") +
  ylab("")
  
```

The total migrant deaths/missing seemed to have peaked in 2016 and is on a downward trend. Strangely there were more deaths reported than missing in the year 2015. As the deaths and missing increased till 2016, so did the number of survivors (16,216). We know that 2016 was the peak for the year of migration across the Mediterranean.  

```{r message=FALSE, warning=FALSE}
# monthly pattern  
raw %>% 
  group_by(`Reported Year`, `Reported Month`) %>% 
   select(`Reported Year`, `Number Dead`, `Number Missing`, `Number of Survivors`,
         `Number of Females`, `Number of Males`, `Number of Children`) %>% 
  summarise_all(funs(sum(., na.rm = TRUE))) %>% 
  mutate(Date = lubridate::dmy(paste0("01-",`Reported Month`, "-",`Reported Year`))) %>% 
  mutate(Season = if_else(`Reported Month` %in% c("Jan", "Feb", "Mar"), "Winter",
                          if_else(`Reported Month` %in% c("Apr", "May", "Jun"), "Spring",
                                  if_else(`Reported Month` %in% c("Jul", "Aug", "Sep"), "Summer", "Autumn")))) %>% 
  ggplot(aes(x = `Date`)) +
  geom_col(aes(y = `Number Dead` + `Number Missing`, fill = "Total Dead & Missing"), alpha = 0.5) + 
  geom_line(aes(y = `Number Dead`, colour = "Number Dead")) +
  geom_line(aes(y = `Number Missing`, colour = "Number Missing")) +
  theme(legend.position="bottom", legend.title=element_blank()) +
  ggtitle("Migrant Deaths Over The Years") +
  ylab("")
```



```{r warning = FALSE, message=FALSE}
raw %>% 
  mutate(Season = if_else(`Reported Month` %in% c("Jan", "Feb", "Mar"), "Winter",
                          if_else(`Reported Month` %in% c("Apr", "May", "Jun"), "Spring",
                                  if_else(`Reported Month` %in% c("Jul", "Aug", "Sep"), "Summer", "Autumn")))) %>% 
  group_by(`Reported Year`, Season) %>% 
   select(`Reported Year`, `Number Dead`, `Number Missing`, `Number of Survivors`,
         `Number of Females`, `Number of Males`, `Number of Children`) %>% 
  summarise_all(funs(sum(., na.rm = TRUE))) %>% 
   ggplot(aes(x = `Reported Year`)) +
   geom_col(aes(y = `Number Dead` + `Number Missing` + `Number of Survivors`, fill = factor(Season, levels = c("Winter", "Spring", "Summer", "Autumn"), ordered = TRUE)), position = "dodge", alpha = 0.2) +
   geom_col(aes(y = `Number Dead` + `Number Missing` , fill = factor(Season, levels = c("Winter", "Spring", "Summer", "Autumn"), ordered = TRUE)), position = "dodge", alpha = 1) +
  scale_alpha("Alpha",range = c(0.2, 1), labels = c("Total Attempted", "Total Dead/Missing")) +
  theme(legend.position="bottom", legend.title=element_blank()) +
  ggtitle("Total Attempted Migration V/S Total Dead or Missing - Seasonal Variation") +
   ylab("")

```


The trend of increasing total migrations in warmer seasons i.e., spring and summer, is consistent across the years 2014-16 however, 2017 and 2018 show different trends. For one, the total attempted migration dipped in the summer of 2017 and started to increase in autum and stayed relatively high in the winter of 2018.  










```{r mediterranean_region, warning = FALSE, message=FALSE}
world <- map_data("world")
md <- ggplot() +
  geom_map(data = world, map = world, aes(x = long, y = lat, map_id = region), colour = "white", fill = "gray50", size = 0.2) + 
  ylim(c(29, 47)) + 
  xlim(c(-8, 42)) + 
  coord_quickmap() +
  theme(panel.background = element_rect(fill = 'light blue')) + labs(x="", y="")
```

```{r message=FALSE, warning=FALSE}
route_totals <- raw %>% 
  group_by(`Migration Route`) %>% 
  mutate(`Total Migrants` = `Total Dead and Missing` + `Number of Survivors`) %>% 
  summarise(lat = mean(Latitude, na.rm = TRUE),
            long = mean(Longitude, na.rm = TRUE),
            `Total Migrants` = sum(`Total Migrants`, na.rm = TRUE))
  
md + 
  geom_point(data = route_totals,
             aes(x = long, y = lat, size = `Total Migrants`),
             alpha = 0.70,
             colour = "salmon") +
  theme(legend.position = "bottom") +
  ggtitle("Total Migrants By Different Routes")
```

```{r fig.show="animate", message=FALSE, warning=FALSE}
raw_w_total_migrants <- raw %>% 
  rowwise() %>% 
  mutate(`Total Migrants` = sum(`Total Dead and Missing`, `Number of Survivors`, na.rm = TRUE)) %>% 
  mutate(month_year = ymd(paste0(year(`Reported Date`), "-",month(`Reported Date`),"-01"))) %>% 
  arrange(`Reported Date`)

md_time <- md  +
  geom_point(data = select(raw_w_total_migrants, Longitude, Latitude, month_year, `Migration Route`, `Total Migrants`),
             aes(x = Longitude, y = Latitude,
                 frame = month_year,
                 cumulative = TRUE,
                 colour = `Migration Route`,
                 size = `Total Migrants`),
             alpha = 1/2) +
  ggtitle("Total Reported Migration Attempts")

```

```{r migration_time_lapse, fig.show="animate", message=FALSE, warning=FALSE}
gganimate(p = md_time, interval = 0.2)
```

An observation from the timelapse is that towards the latter part of 2017 and the early months of 2018, Wester Mediterranean Route has become more popular. It is worth checking why that is the case.  

Another thing worth checking is whether the proportion of dead/missing versus survived has changed over time.  

```{r prop_dead_vs_survived, warning = FALSE, message = FALSE}
for_lm <- raw_w_total_migrants %>% 
  group_by(month_year) %>% 
  mutate(`Survival Rate` = if_else(is.na(`Number of Survivors`/`Total Migrants`), 0,
                                   round(`Number of Survivors`/`Total Migrants`, digits = 4))) %>% 
  summarise(`Survival Rate` = weighted.mean(`Survival Rate`, `Total Migrants`), `Total Migrants` = sum(`Total Migrants`))

model <- lm(data = for_lm, `Survival Rate` ~ `Total Migrants` + month_year)
for_lm$linear_predictor <- stats::predict(model, newdata = for_lm)
err <- stats::predict(model, newdata = for_lm, se = TRUE)
for_lm$ucl <- err$fit + 1.96*err$se.fit
for_lm$lcl <- err$fit - 1.96*err$se.fit

ggplot(for_lm) +
  geom_point(aes(x = month_year, y = `Survival Rate`)) +
  geom_smooth(aes(x = month_year, y = linear_predictor, ymin = lcl, ymax = ucl, colour = "Linear Predictor"), size = 1.5,
              se = TRUE, stat = "smooth") +
  ggtitle("Survival Rate of Migrants Over Time", 
          subtitle = "Along with a (weak) predictor line") +
  xlab("Date") + 
  scale_y_continuous(labels = scales::percent)

```
No trend is evident here. Though on average the survival rate increases gradually till mid-2016 and then begins to decline again.  


```{r warning = FALSE, message=FALSE}

raw_w_total_migrants %>% 
  group_by(month_year, `Migration Route`) %>% 
  mutate(`Survival Rate` = if_else(is.na(`Number of Survivors`/`Total Migrants`), 0,
                                   round(`Number of Survivors`/`Total Migrants`, digits = 4))) %>% 
  summarise(`Survival Rate` = weighted.mean(`Survival Rate`, `Total Migrants`), `Total Migrants` = sum(`Total Migrants`)) %>%   ggplot(aes(x = month_year, y = `Survival Rate`, colour = `Migration Route`)) +
  geom_point(show.legend = FALSE)  +
  facet_grid(.~`Migration Route`) +
  stat_smooth(se = FALSE, show.legend = FALSE)  + 
  ggtitle("Survival Rate For Different Migration Routes",
          subtitle = "Along with (weak) predictor lines") +
   xlab("Date") + 
  scale_y_continuous(labels = scales::percent)
  
```

No particular trend here (since the predictors are weak) but overall, the Western Mediterranean route had very low survival rates in right upto mid-2016 and then it begins to improve a bit. Overall, the Western Mediterranean route has the lowest survival rate.  

There is possible a trend in the Western Mediterranean Route. Mainly because there seem to be two very distinct groups, one with a higher survival rate (>50%) and one with a lower one (<50%). It seems a bit systematic to be random and it is possibly worth investigating further.   



```{r}
raw_w_total_migrants %>% 
  filter(`Migration Route` == "Western Mediterranean") %>% 
  group_by(month_year) %>% 
  mutate(`Survival Rate` = if_else(is.na(`Number of Survivors`/`Total Migrants`), 0,
                                   round(`Number of Survivors`/`Total Migrants`, digits = 4))) %>% 
  summarise(`Survival Rate` = weighted.mean(`Survival Rate`, `Total Migrants`), `Total Migrants` = sum(`Total Migrants`)) %>%   ggplot(aes(x = month_year, y = `Survival Rate`, colour = `Survival Rate` > 0.5)) +
  geom_point(show.legend = FALSE)  +
  stat_ellipse(show.legend = FALSE) +
  ggtitle("Survival Rate For West Mediterranean Migration Route",
          subtitle = "Appearance of two groups; one with higher survival rate than the other") +
   xlab("Date") + 
  scale_y_continuous(labels = scales::percent)
```






# Appendix  
Original column names and their description as provided by Missing Migrants Project.  

Variable Name | Description
-------|------------------------------------------------  
Web ID | An automatically generated number used to identify each unique entry in the dataset.  
Region of incident | The region in which an incident took place. For more about regional classifications used in the dataset, [click here](https://missingmigrants.iom.int/regional-classifications).  
Reported date | Estimated date of death. In cases where the exact date of death is not known, this variable indicates the date in which the body or bodies were found. In cases where data are drawn from surviving migrants, witnesses or other interviews, this variable is entered as the date of the death as reported by the interviewee.  At a minimum, the month and the year of death is recorded. In some cases, official statistics are not disaggregated by the incident, meaning that data is reported as a total number of deaths occurring during a certain time period. In such cases the entry is marked as a “cumulative total,” and the latest date of the range is recorded, with the full dates recorded in the comments.  
Reported year | The year in which the incident occurred.  
Reported month | The month in which the incident occurred.  
Number dead | The total number of people confirmed dead in one incident, i.e. the number of bodies recovered.  If migrants are missing and presumed dead, such as in cases of shipwrecks, leave blank.  
Number missing | The total number of those who are missing and are thus assumed to be dead.  This variable is generally recorded in incidents involving shipwrecks.  The number of missing is calculated by subtracting the number of bodies recovered from a shipwreck and the number of survivors from the total number of migrants reported to have been on the boat.  This number may be reported by surviving migrants or witnesses.  If no missing persons are reported, it is left blank.  
Total dead and missing | The sum of the ‘number dead’ and ‘number missing’ variables.  
Number of survivors | The number of migrants that survived the incident, if known. The age, gender, and country of origin of survivors are recorded in the ‘Comments’ variable if known. If unknown, it is left blank  
Number of females | Indicates the number of females found dead or missing. If unknown, it is left blank. 
Number of males | Indicates the number of males found dead or missing. If unknown, it is left blank.  
Number of children | Indicates the number of individuals under the age of 18 found dead or missing. If unknown, it is left blank.  
Age | The age of the decedent(s). Occasionally, an estimated age range is recorded. If unknown, it is left blank.  
Country of origin | Country of birth of the decedent. If unknown, the entry will be marked “unknown”.  
Region of origin | Region of origin of the decedent(s). In some incidents, region of origin may be marked as “Presumed” or “(P)” if migrants travelling through that location are known to hail from a certain region. If unknown, the entry will be marked “unknown”.  
Cause of death | The determination of conditions resulting in the migrant's death i.e. the circumstances of the event that produced the fatal injury. If unknown, the reason why is included where possible.  For example, “Unknown – skeletal remains only”, is used in cases in which only the skeleton of the decedent was found.  
Location description | Place where the death(s) occurred or where the body or bodies were found. Nearby towns or cities or borders are included where possible. When incidents are reported in an unspecified location, this will be noted.  
Location coordinates |  Place where the death(s) occurred or where the body or bodies were found. In many regions, most notably the Mediterranean, geographic coordinates are estimated as precise locations are not often known. The location description should always be checked against the location coordinates.  
Migration route | Name of the migrant route on which incident occurred, if known. If unknown, it is left blank.  
UNSD geographical grouping | Geographical region in which the incident took place, as designated by the United Nations Statistics Division (UNSD) geoscheme. For more about regional classifications used in the dataset, [click here](https://missingmigrants.iom.int/regional-classifications).  
Source quality | Incidents are ranked on a scale from 1-5 based on the source(s) of information available. Incidents ranked as level 1 are based on information from only one media source. Incidents ranked as level 2 are based on information from uncorroborated eyewitness accounts or data from survey respondents. Incidents ranked as level 3 are based on information from multiple media reports, while level 4 incidents are based on information from at least one NGO, IGO, or another humanitarian actor with direct knowledge of the incident. Incidents ranked at level 5 are based on information from official sources such as coroners, medical examiners, or government officials OR from multiple humanitarian actors.  
Comments | Brief description narrating additional facts about the death.  If no extra information is available, this is left blank.  


